---
layout: post
author: dain
title: "[Project] Git Secretμ„ μ΄μ©ν•΄ μ¤‘μ”ν• μ •λ³΄ κ°€λ¦¬κΈ° PART 1"
date: 2022-11-26 01:53:00 +0900
categories: [Project, Project]
tags: [github, deploy, secret]
pin: false
---

μ•„μ° μ°ΈμΌλ΅ κ³¤λ€ν• μƒν™©μ΄λ΅λ‹¤...π¤”

`Github Page`λ΅ λ¬΄λ£ νΈμ¤ν…μ„ ν•  μ μλ” λ€μ‹  ν•΄λ‹Ή λ νΌμ§€ν† λ¦¬λ¥Ό `Public`μΌλ΅ κ³µκ°ν•΄μ•Όν•λ‹¤.  
λ­... λ‚μ ~~ν•μΈμ μ›€μ§μ΄λ” μ„± κ°™μ€~~ μ½”λ“λ¥Ό κ³µκ°ν•λ” κ²ƒμ€ ~~μ΅°κΈ λ¶€λ„λ½κ³  μ•~~ κ΄μ°®μ§€λ§...

μ†μ…λ΅κ·ΈμΈμ— ν•„μ”ν• **μΉ΄μΉ΄μ¤ λ΅κ·ΈμΈ API ν† ν°**μ€ μ¬λ¦¬λ©΄ λ³΄μ•μƒ μ·¨μ•½ν•μ–μµλ‹κΉ.
κ·Έλ¦¬κ³  λ‚λ¥Ό λ” μ¬ν”„κ² ν•λ” κ±΄ μ΄κ±Έ μ΄λ―Έ **ν‘Έμ‹ ν•κ³  λ‚μ„** κΉ¨λ‹¬μ•λ‹¤λ” κ²ƒ...π±
(μ—¬λ¬λ¶„μ€ λ¶€λ”” ν‘Έμ‹ ν•κΈ°μ „μ— μ΄ κΈ€μ„ λ³΄κ³  μ μ©ν•μ‹κΈΈ...)

κ·Έλμ„ μ •λ¦¬ν•  λ°©λ²•μ€ λ‹¤μκ³Ό κ°™λ‹¤.

1. λ ν¬μ§€ν† λ¦¬μ— μ¤‘μ”ν• μ •λ³΄λ¥Ό μ•”νΈν™”ν•μ—¬ μ¬λ¦¬κ³  λ°°ν¬ν•  λ• λ³µνΈν™”ν•μ—¬ μ‚¬μ©ν•λ” λ°©λ²•.
2. μ΄λ―Έ History(μ»¤λ°‹ λ‚΄μ—­)μ— μ¬λΌκ°€λ²„λ¦° μ¤‘μ”ν• μ •λ³΄λ¥Ό μ‚­μ ν•λ” λ°©λ²•.

μ‹-μ‘π”¥

<br/>

## 1. μ¤‘μ”ν• μ •λ³΄λ¥Ό μ•”νΈν™”ν•μ—¬ μ¬λ¦¬κ³  λ°°ν¬ν•  λ• λ³µνΈν™”ν•μ—¬ μ‚¬μ©ν•λ” λ°©λ²• (Feat. Git Secret) π”

λ‚λ” Git Workflowλ¥Ό μ‚¬μ©ν•μ—¬ CI/CDλ¥Ό μ μ©ν–κΈ° λ•λ¬Έμ—, μ •λ³΄λ¥Ό μ•”νΈν™” ν•λ” κ²ƒ λΏ μ•„λ‹λΌ, λ°°ν¬μ‹ μλ™ λ³µνΈν™”ν•μ—¬ μ‚¬μ©ν•  μ μμ–΄μ•Όν–λ‹¤.

λ¨Όμ € μ „μ²΄μ μΈ νλ¦„μ„ μ •λ¦¬ν•΄λ³΄μ.

1. μ›ν•λ” μ •λ³΄λ¥Ό GPGλ΅ μ•”νΈν™”ν•λ‹¤.(λ³µνΈν™” ν‚¤ μƒμ„±)
2. λ ν¬μ§€ν† λ¦¬μ— μ•”νΈν™”ν• νμΌμ„ μ¬λ¦°λ‹¤.
3. Github Secretμ— λ³µνΈν™” ν‚¤λ¥Ό λ“±λ΅ν•λ‹¤.
4. CI/CD κ³Όμ •μ—μ„ Secretμ„ μ΄μ©ν•μ—¬ νμΌμ„ λ³µνΈν™”ν•λ‹¤.

μ΄λ ‡κ² μ •λ¦¬ν•λ‹ μ •λ§ κ°„λ‹¨ν•μ§€ μ•λ‚μ”!π‘

<br/>

### 1. μ›ν•λ” μ •λ³΄λ¥Ό GPGλ΅ μ•”νΈν™”ν•λ‹¤. (λ³µνΈν™” ν‚¤ μƒμ„±)

**GPG(GNU Privacy Guard)** λ” RSA λ°©μ‹μ„ μ‚¬μ©ν•λ” λ¬΄λ£ μ•”νΈν™” ν”„λ΅κ·Έλ¨μ…λ‹λ‹¤. CI/CD κ³Όμ •μ—μ„ git-secretμ„ μ‚¬μ©ν•  μμ •μΈλ° git-secretμ€ νμΌμ„ μ•”νΈν™”ν•  λ• gpgλ¥Ό μ‚¬μ©ν•λ‹¤κ³  λ…μ‹λμ–΄μμµλ‹λ‹¤.  
git-secret | [https://git-secret.io/](https://git-secret.io/)

μ°Ύμ•„λ³΄λ‹¤ λ³΄λ‹ GPGλ” κΉƒν—λΈμ—μ„ μ»¤λ°‹μ— λ€ν• μ„λ…μ—λ„ μ‚¬μ©λμ—μµλ‹λ‹¤! μΈμ¦λ μ»¤λ°‹μ„ ν•κ³ μ‹¶λ‹¤λ©΄ μ•„λ λ§ν¬λ¥Ό ν†µν•΄ μ‚΄ν΄λ³΄μ…”λ„ μΆ‹μ„ κ²ƒ κ°™μµλ‹λ‹¤!  
Git Docs - Managing Comit Signature Verification | [https://docs.github.com/en/authentication/managing-commit-signature-verification/about-commit-signature-verification](https://docs.github.com/en/authentication/managing-commit-signature-verification/about-commit-signature-verification)

<br/>

λ¨Όμ € GPGλ¥Ό μ„¤μΉν•©λ‹λ‹¤. `brew`, `apt` λ“±μ„ ν†µν•΄ μ„¤μΉν•  μ μλ”λ° μλ„μ°λ” μ‚¬μ΄νΈμ—μ„ λ‹¤μ΄λ΅λ“ ν•©λ‹λ‹¤.  
 [https://gnupg.org/download/](https://gnupg.org/download/) μ— μ ‘μ†ν•΄μ„ μ¤ν¬λ΅¤μ„ λ‚΄λ¦¬λ©΄ μλ„μ° λ²„μ „μΈ `Gpg4win` μ΄ λ³΄μ…λ‹λ‹¤. λ‹¤μ΄λ΅λ“ ν›„ μ„¤μΉν•΄μ¤λ‹λ‹¤.

![GPG Download Site](/assets/img/post/1126_gpg.png)
_Download Gpg4win_

```terminal
// μ„¤μΉ ν™•μΈ
gpg --version
// AES256 νμΌ μ•”νΈν™”
gpg --symmetric --cipher-algo AES256 .\src\api\oauth.ts
```

μ„λ” oauth.ts λΌλ” νμΌμ„ μ•”νΈν™” ν•λ” μμ‹μ…λ‹λ‹¤. μ„ λ…λ Ήμ–΄λ¥Ό μ…λ ¥ν•λ©΄ μ•„λμ™€ κ°™μ΄ Passphraseλ¥Ό μ…λ ¥ν•λ” μ°½μ΄ λ‚μµλ‹λ‹¤. μ΄ Passphraseλ¥Ό ν›„μ— μ‚¬μ©ν•κ²λ©λ‹λ‹¤. μ κΈ°λ΅ν•΄λ‘΅λ‹λ‹¤.

![GPG Download Site](/assets/img/post/1126_passphrase.png)
_passphrase_

μ…λ ¥μ„ μ™„λ£ν•λ©΄ `νμΌμ΄λ¦„.gpg` (μ €μ κ²½μ° oauth.ts.gpg)λΌλ” μ•”νΈν™”λ νμΌμ΄ μƒμ„±λ©λ‹λ‹¤!

<br/>

### 2. λ ν¬μ§€ν† λ¦¬μ— μ•”νΈν™”ν• νμΌμ„ μ¬λ¦°λ‹¤.

μ•”νΈν™”λ νμΌμ„ κΉƒν—λΈμ— μ¬λ ¤μ¤λ‹λ‹¤.

```terminal
git add .\src\api\oauth.ts.gpg
```

λ§μ•½ (μ €μ²λΌ) μ΄λ―Έ μ›λ³Έ νμΌμ΄ μ›κ²© λ ν¬μ§€ν† λ¦¬μ— μ¬λΌκ°„ μƒνƒλΌλ©΄ κ·Έ νμΌμ„ μ‚­μ ν•κ³  λ‹¤μ‹ μ¬λΌκ°€μ§€ μ•λ„λ΅ `.gitignore` μ— μ¶”κ°€ν•΄μ£Όμ‹λ©΄ λκ² μµλ‹λ‹¤.

```terminal
// μΊμ‹λ νμΌ μ‚­μ 
git rm --cached .\src\api\oauth.ts
```

μ»¤λ°‹ν•κ³  ν‘Έμ‹ν•΄μ„ λ³µνΈν™”λ νμΌμ΄ μ μ¬λΌκ°”λ”μ§€ ν™•μΈν•΄μ£Όμ„Έμ”!π™‚

<br/>

### 3. Github Secretμ— λ³µνΈν™” ν‚¤λ¥Ό λ“±λ΅ν•λ‹¤.

μ•μ„ νμΌμ„ μ•”νΈν™” ν•  λ• μ‚¬μ©ν–λ λΉ„λ°€λ²νΈλ¥Ό κΉƒν—λΈμ—μ„ SecretμΌλ΅ λ“±λ΅ν•©λ‹λ‹¤. μ•„λ ν™”λ©΄(Settings > Secrets > Actions)μ—μ„ New Repository Secret λ²„νΌμ„ λλ¬ λΉ„λ°€λ²νΈλ¥Ό μ…λ ¥ν•΄μ£Όλ©΄ λ©λ‹λ‹¤. μ €λ” λΉ„λ°€λ²νΈμ μ΄λ¦„μ„ `PASS_PHRASE`λ΅ μ§€μ •ν–μµλ‹λ‹¤.

![Github](/assets/img/post/1126_secret.png)
_Add Secret_

<br/>

### 4. CI/CD κ³Όμ •μ—μ„ Secretμ„ μ΄μ©ν•μ—¬ νμΌμ„ λ³µνΈν™”ν•λ‹¤.

μ΄μ  λ§μ§€λ§‰μΌλ΅ Git Workflow CI/CD κ³Όμ •μ— λ³µνΈν™” κ³Όμ •μ„ μ¶”κ°€ν•©λ‹λ‹¤! μ•„λμ μμ‹λ” PASS_PHRASEλ΅ μ•μ—μ„ μƒμ„±ν• λΉ„λ°€λ²νΈ `secrets.PASS_PHRASE`λ¥Ό λ¶λ¬μµλ‹λ‹¤. κ·Έλ¦¬κ³ 
`oauth.ts.gpg` νμΌμ„ λ³µνΈν™” ν•μ—¬ `oauth.ts`λ΅ μ €μ¥ν•©λ‹λ‹¤.

```yml
- name: decrypt file
  run: gpg --quiet --batch --yes --decrypt --passphrase="$PASS_PHRASE" --output src/api/oauth.ts src/api/oauth.ts.gpg
  env:
    PASS_PHRASE: ${{ secrets.PASS_PHRASE }}
```

π”¥μ£Όμ! λ³΄μ•μƒ workflow μ‹¤ν–‰μ‹ promptμ— secret λ° λ³µνΈν™”λ λ‚΄μ©μ΄ μ¶λ ¥λμ§€ μ•λ„λ΅ ν™•μΈν•΄μ£Όμ„Έμ”!

μ΄λ ‡κ² ν•λ©΄ CI κ³Όμ •μ—μ„ ν•΄λ‹Ή νμΌμ„ λ³µνΈν™” ν• ν›„ λ°°ν¬ν•  μ‚¬μ΄νΈλ¥Ό λΉλ“ν•κ²λ©λ‹λ‹¤!

<br/>

## 2. History(μ»¤λ°‹ λ‚΄μ—­)μ— μ¬λΌκ°„ μ •λ³΄λ¥Ό μ‚­μ ν•λ” λ°©λ²• π”¥

μ€ κΈ€μ΄ κΈΈμ–΄μ Έμ„ λ‹¤μ ν¬μ¤νΈμ—μ„ μ •λ¦¬ν•λ„λ΅ ν•κ² μµλ‹λ‹¤!π™‚

<br/>

πΆ ν”„λ΅μ νΈ μ „μ²΄ μ½”λ“ | [https://github.com/roundshoulder/cs-letter-frontend](https://github.com/roundshoulder/cs-letter-frontend)

π‘ λ°°ν¬ν• μ„λΉ„μ¤ (λ¨λ°”μΌ μ›Ή) | [https://chosung-letter.com/](https://chosung-letter.com/)
